<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Português Acessível para Surdos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,sans-serif;max-width:980px;margin:24px auto;padding:0 16px;line-height:1.5;background:#fdfdfd;color:#333}
    h1{font-size:1.5rem;margin:0 0 8px}
    .grid{display:grid;gap:16px}
    @media(min-width:940px){.grid{grid-template-columns:1fr 1fr}}
    .card{border:1px solid #e5e5e5;border-radius:12px;padding:16px;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.05)}
    textarea{width:100%;min-height:180px;padding:12px;border:1px solid #ddd;border-radius:10px;resize:vertical}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0 4px}
    button{padding:10px 14px;border:1px solid #ddd;border-radius:10px;background:#fff;cursor:pointer;font-weight:500}
    button:hover{background:#f5f5f5;border-color:#ccc}
    button:disabled{background:#f5f5f5;color:#999;cursor:not-allowed}
    .primary{background:#007bff;color:white;border-color:#007bff}
    .primary:hover{background:#0056b3;border-color:#0056b3}
    .small{font-size:.9rem;color:#555}
    .out{white-space:pre-wrap;background:#f9f9f9;padding:12px;border:1px solid #eee;border-radius:10px;min-height:50px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .row{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
    label{display:inline-flex;gap:8px;align-items:center;cursor:pointer}
  </style>
</head>
<body>
  <h1>Português Acessível para Surdos</h1>
  <p class="small">Cole um texto para adaptar. Escolha "Simplificado leve" para clareza ou "Estilo Libras" para uma estrutura próxima à Libras.</p>

  <div class="grid">
    <div class="card">
      <h3>Entrada</h3>
      <textarea id="input" placeholder="Cole seu texto aqui..."></textarea>

      <div class="row" style="margin:12px 0">
        <label><input type="radio" name="mode" value="simple" checked> Simplificado leve</label>
        <label><input type="radio" name="mode" value="libras"> Estilo Libras</label>
      </div>

      <div class="row" style="margin:8px 0">
        <label class="small"><input type="checkbox" id="strictOrder" checked> Tempo no início (Estilo Libras)</label>
      </div>

      <div class="toolbar">
        <button onclick="fillSample()">Exemplo</button>
        <button onclick="clearAll()">Limpar</button>
        <button id="generateBtn" class="primary" onclick="process()">Gerar</button>
      </div>
    </div>

    <div class="card">
      <h3>Lista de Exceções</h3>
      <p class="small">Palavras que não devem ser alteradas (uma por linha). Sua lista é salva no navegador.</p>
      <textarea id="whitelistBox">discipulado
família
famílias
comunidade
comunidades
verdade
belo
bom
Salmo
Salmos
Libras
Português
Bíblia</textarea>
      <div class="toolbar">
        <button onclick="loadWhitelist()">Salvar e Aplicar Lista</button>
      </div>
    </div>
  </div>

  <div class="grid" style="margin-top:16px">
    <div class="card">
      <h3>Versão Simplificada</h3>
      <div class="toolbar">
        <button onclick="copyOut('#outSimple', this)">Copiar</button>
      </div>
      <div id="outSimple" class="out"></div>
    </div>

    <div class="card">
      <h3>Versão Estilo Libras</h3>
      <div class="toolbar">
        <button onclick="copyOut('#outLibras', this)">Copiar</button>
      </div>
      <div id="outLibras" class="out mono"></div>
    </div>
  </div>

<script>
/* ===== Config & State ===== */
let WHITELIST = new Set();

// Dicionário de sinônimos expandido
const SIMPLE_REPLACE = new Map(Object.entries({
  "todavia":"mas", "entretanto":"mas", "porém":"mas", "contudo":"mas",
  "consequentemente":"por isso", "portanto":"por isso",
  "posteriormente":"depois", "anteriormente":"antes",
  "frequentemente": "muitas vezes",
  "prover": "dar", "fornecer": "dar",
  "obter": "conseguir", "alcançar": "conseguir",
  "realizar": "fazer", "efetuar": "fazer",
  "utilizar": "usar",
  "essencial": "importante", "fundamental": "importante",
  "harmonia": "paz",
  "denota": "mostra",
  "necessário": "precisa",
  "demonstrar": "mostrar",
  "objetivo": "meta",
}));

const ARTICLES = ["o","a","os","as","um","uma","uns","umas","do","da","dos","das","ao","à","aos","às","no","na","nos","nas"];
const FILLERS = ["realmente","basicamente","literalmente","provavelmente","talvez","certamente","claramente","apenas","somente","inclusive","muito","pouco"];
const TEMP_MARKERS = ["hoje","amanhã","ontem","agora","depois","antes","cedo","tarde","noite",
  "segunda","terça","quarta","quinta","sexta","sábado","domingo",
  "janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"];

/* ===== Core Functions ===== */

// Função de redução de verbos aprimorada
function reduceVerbSafely(word) {
  const w = word.toLowerCase();
  if (WHITELIST.has(w) || w.length < 4 || /[^a-záéíóúâêôãõç]/i.test(w)) {
    return word;
  }
  const original = word;

  // Regras de redução, da mais específica para a mais geral
  const rules = [
    [/(.+)ei\b/i, "$1ar"],      // Falei -> Falar
    [/(.+)ou\b/i, "$1ar"],      // Falou -> Falar
    [/(.+)am\b/i, "$1ar"],      // Falam -> Falar
    [/(.+)amos\b/i, "$1ar"],    // Falamos -> Falar
    [/(.+)aram\b/i, "$1ar"],    // Falaram -> Falar
    [/(.+)arão\b/i, "$1ar"],    // Falarão -> Falar
    [/(.+)aria\b/i, "$1ar"],    // Falaria -> Falar
    [/(.+)asse\b/i, "$1ar"],    // Falasse -> Falar
    [/(.+)ava\b/i, "$1ar"],     // Falava -> Falar
    [/(.+)ando\b/i, "$1ar"],    // Falando -> Falar
    [/(.+)ado\b/i, "$1ar"],     // Falado -> Falar
    [/(.+)(emos|eram|erão|eria|esse|endo|ido)\b/i, "$1er"], // Variações de -er
    [/(.+)(imos|iram|irão|iria|isse|indo)\b/i, "$1ir"], // Variações de -ir
  ];

  for (const [re, rep] of rules) {
    if (re.test(original)) {
      return original.replace(re, rep);
    }
  }
  return original;
}

function splitSentences(t) {
  return t.replace(/\s+/g, " ").split(/(?<=[.!?])\s+/).map(s => s.trim()).filter(Boolean);
}

function simplifySentence(s) {
  let out = " " + s.toLowerCase() + " ";
  SIMPLE_REPLACE.forEach((to, from) => {
    out = out.replace(new RegExp(`\\b${from}\\b`, "gi"), ` ${to} `);
  });
  FILLERS.forEach(w => {
    out = out.replace(new RegExp(`\\b${w}\\b`, "gi"), " ");
  });
  out = out.replace(/\s+/g, " ").trim();
  return out.charAt(0).toUpperCase() + out.slice(1); // Capitaliza o início
}

function toLibrasStyleLine(s, opts) {
  const { strictOrder = true } = opts;
  let x = s.replace(/["“”'()]+/g, " ");
  x = x.replace(/[,;:]+/g, " ");

  let tokens = x.split(/\s+/).filter(Boolean).map(t => {
    const low = t.toLowerCase();
    if (WHITELIST.has(low)) return t;
    if (ARTICLES.includes(low)) return "";
    return t;
  }).filter(Boolean);

  tokens = tokens.map(t => {
    if (WHITELIST.has(t.toLowerCase()) || /[A-Z]{2,}/.test(t)) return t;
    return reduceVerbSafely(t);
  });

  const tempo = [];
  const resto = [];
  tokens.forEach(t => {
    if (TEMP_MARKERS.includes(t.toLowerCase())) tempo.push(t.toUpperCase());
    else resto.push(t);
  });

  const ordered = (strictOrder && tempo.length) ? [...tempo, ...resto] : tokens;
  return ordered.join(" ").replace(/\s+/g, " ").trim().toUpperCase();
}

function process() {
  const generateBtn = document.getElementById('generateBtn');
  flash(generateBtn, "Gerando...", 10000, true); // Desativa o botão

  // Usar setTimeout para o navegador atualizar a UI antes de processar
  setTimeout(() => {
    const input = document.getElementById('input').value.trim();
    const outSimple = document.getElementById('outSimple');
    const outLibras = document.getElementById('outLibras');
    const strictOrder = document.getElementById('strictOrder').checked;

    if (!input) {
      outSimple.textContent = "";
      outLibras.textContent = "";
      flash(generateBtn, "Gerar", 1, false); // Reativa o botão
      return;
    }

    const sentences = splitSentences(input);
    const simpleLines = sentences.map(simplifySentence);
    const librasLines = sentences.map(s => toLibrasStyleLine(s, { strictOrder }));

    outSimple.innerHTML = simpleLines.map(line => `• ${line}`).join("  
");
    outLibras.innerHTML = librasLines.map(line => `• ${line}`).join("  
");

    flash(generateBtn, "Gerar", 1, false); // Reativa o botão
  }, 10);
}

/* ===== UI & Persistence ===== */

// Salva e carrega a lista de exceções
function loadWhitelist() {
  const whitelistText = document.getElementById('whitelistBox').value;
  WHITELIST = new Set(whitelistText.split(/\r?\n/).map(s => s.trim().toLowerCase()).filter(Boolean));
  localStorage.setItem('userWhitelist', whitelistText);
  flash(document.querySelector('#whitelistBox + .toolbar button'), "Lista Salva!", 1500);
}

function restoreWhitelistFromStorage() {
  const savedList = localStorage.getItem('userWhitelist');
  if (savedList) {
    document.getElementById('whitelistBox').value = savedList;
  }
  loadWhitelist();
}

function fillSample() {
  document.getElementById('input').value = "Nós fomos ontem à praia e, francamente, o objetivo era realizar um bom descanso. Posteriormente, nós voltaremos para casa utilizando o mesmo caminho.";
  process();
}

function clearAll() {
  document.getElementById('input').value = "";
  document.getElementById('outSimple').textContent = "";
  document.getElementById('outLibras').textContent = "";
}

function copyOut(selector, btn) {
  const el = document.querySelector(selector);
  const text = el.innerText; // Usar innerText para preservar quebras de linha
  if (!text) return;

  navigator.clipboard.writeText(text).then(() => {
    flash(btn, "Copiado!", 1200);
  }).catch(() => {
    flash(btn, "Erro ao copiar", 1200);
  });
}

function flash(btn, msg, duration = 1200, disabled = false) {
  const oldText = btn.textContent;
  btn.textContent = msg;
  btn.disabled = disabled;
  setTimeout(() => {
    btn.textContent = oldText;
    btn.disabled = false;
  }, duration);
}

// Inicialização
document.addEventListener('DOMContentLoaded', restoreWhitelistFromStorage);
</script>
</body>
</html>
