<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Portugu√™s Acess√≠vel para Surdos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,sans-serif;max-width:980px;margin:24px auto;padding:0 16px;line-height:1.5}
    h1{font-size:1.35rem;margin:0 0 8px}
    .grid{display:grid;gap:16px}
    @media(min-width:940px){.grid{grid-template-columns:1fr 1fr}}
    .card{border:1px solid #eee;border-radius:12px;padding:12px;background:#fafafa}
    textarea{width:100%;min-height:180px;padding:12px;border:1px solid #ddd;border-radius:10px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    button{padding:10px 12px;border:1px solid #ddd;border-radius:10px;background:#fff;cursor:pointer}
    button:hover{background:#f2f2f2}
    .small{font-size:.9rem;color:#555}
    .out{white-space:pre-wrap;background:#fff;padding:10px;border:1px solid #eee;border-radius:10px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .row{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
    label{display:inline-flex;gap:8px;align-items:center}
  </style>
</head>
<body>
  <h1>Portugu√™s Acess√≠vel para Surdos</h1>
  <p class="small">Escolha o modo antes de gerar. Para textos de opini√£o e feedback, use Simplificado leve. Para aproxima√ß√£o da l√≥gica da Libras, use Estilo Libras.</p>

  <div class="grid">
    <div class="card">
      <h3>Entrada</h3>
      <textarea id="input" placeholder="Cole seu texto aqui..."></textarea>

      <div class="row" style="margin:8px 0">
        <label><input type="radio" name="mode" value="simple" checked> Simplificado leve</label>
        <label><input type="radio" name="mode" value="libras"> Estilo Libras</label>
      </div>

      <div class="row" style="margin:8px 0">
        <label class="small"><input type="checkbox" id="strictOrder" checked> Tempo no in√≠cio quando houver</label>
        <label class="small"><input type="checkbox" id="useWhitelist" checked> Respeitar lista de exce√ß√µes</label>
      </div>

      <div class="toolbar">
        <button onclick="fillSample()">Exemplo</button>
        <button onclick="clearAll()">Limpar</button>
        <button onclick="process()">Gerar</button>
      </div>
    </div>

    <div class="card">
      <h3>Lista de exce√ß√µes</h3>
      <p class="small">Palavras que n√£o devem ser alteradas. Uma por linha. Edite √† vontade.</p>
      <textarea id="whitelistBox">discipulado
fam√≠lia
fam√≠lias
comunidade
comunidades
verdade
belo
bom
Salmo
Salmos
Libras
Portugu√™s
B√≠blia</textarea>
      <div class="toolbar">
        <button onclick="loadWhitelist()">Aplicar exce√ß√µes</button>
      </div>
    </div>
  </div>

  <div class="grid" style="margin-top:16px">
    <div class="card">
      <h3>Vers√£o simplificada</h3>
      <div class="toolbar">
        <button onclick="copyOut('#outSimple', this)">Copiar</button>
      </div>
      <div id="outSimple" class="out"></div>
    </div>

    <div class="card">
      <h3>Vers√£o estilo Libras</h3>
      <div class="toolbar">
        <button onclick="copyOut('#outLibras', this)">Copiar</button>
      </div>
      <div id="outLibras" class="out mono"></div>
      <p class="small">Dica: se o texto for t√©cnico ou muito opinativo, prefira o modo Simplificado leve.</p>
    </div>
  </div>

<script>
/* ===== Config ===== */
let WHITELIST = new Set();
function loadWhitelist(){
  const lines = document.getElementById('whitelistBox').value.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  WHITELIST = new Set(lines.map(x=> x.toLowerCase()));
}
loadWhitelist();

/* ===== Regras ===== */
const ARTICLES = ["o","a","os","as","um","uma","uns","umas","do","da","dos","das","ao","√†","aos","√†s"];
const FILLERS = ["realmente","basicamente","literalmente","provavelmente","talvez","certamente","claramente","apenas","somente","inclusive"];
const TEMP_MARKERS = ["hoje","amanh√£","ontem","agora","depois","antes","cedo","tarde","noite",
  "segunda","ter√ßa","quarta","quinta","sexta","s√°bado","domingo",
  "janeiro","fevereiro","mar√ßo","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"];

// >>>>> MELHORIA 1: Dicion√°rio de sin√¥nimos expandido
const SIMPLE_REPLACE = new Map(Object.entries({
  "todavia":"mas", "entretanto":"mas", "por√©m":"mas", "contudo":"mas",
  "consequentemente":"por isso", "portanto":"por isso",
  "posteriormente":"depois", "anteriormente":"antes",
  "frequentemente": "muitas vezes",
  "prover": "dar", "fornecer": "dar",
  "obter": "conseguir", "alcan√ßar": "conseguir",
  "realizar": "fazer", "efetuar": "fazer",
  "utilizar": "usar",
  "essencial": "importante", "fundamental": "importante",
  "harmonia": "paz",
  "denota": "mostra",
  "necess√°rio": "precisa",
  "demonstrar": "mostrar",
  "objetivo": "meta",
}));

// >>>>> MELHORIA 2: Redu√ß√£o de verbos aprimorada
function reduceVerbSafely(word) {
  const w = word.toLowerCase();
  if (WHITELIST.has(w) || w.length < 4 || /[^a-z√°√©√≠√≥√∫√¢√™√¥√£√µ√ß]/i.test(w)) {
    return word;
  }
  const original = word;
  const rules = [
    [/(.+)ei\b/i, "$1ar"], [/(.+)ou\b/i, "$1ar"], [/(.+)am\b/i, "$1ar"], [/(.+)amos\b/i, "$1ar"],
    [/(.+)aram\b/i, "$1ar"], [/(.+)ar√£o\b/i, "$1ar"], [/(.+)aria\b/i, "$1ar"], [/(.+)asse\b/i, "$1ar"],
    [/(.+)ava\b/i, "$1ar"], [/(.+)ando\b/i, "$1ar"], [/(.+)ado\b/i, "$1ar"],
    [/(.+)(emos|eram|er√£o|eria|esse|endo|ido)\b/i, "$1er"],
    [/(.+)(imos|iram|ir√£o|iria|isse|indo)\b/i, "$1ir"],
  ];
  for (const [re, rep] of rules) {
    if (re.test(original)) {
      return original.replace(re, rep);
    }
  }
  return original;
}

/* ===== Pipeline ===== */
function splitSentences(t){
  return t
    .replace(/\s+/g," ")
    .split(/(?<=[\.\!\?\;])\s+|,\s+(?=[A-Z√Å√â√ç√ì√ö√É√ï√Ç√ä√î0-9])/g)
    .map(s=>s.trim())
    .filter(Boolean);
}

function simplifySentence(s){
  let out = " " + s + " ";
  SIMPLE_REPLACE.forEach((to,from)=>{
    out = out.replace(new RegExp("\\b"+from+"\\b","gi"), to);
  });
  FILLERS.forEach(w=>{
    out = out.replace(new RegExp("\\b"+w+"\\b","gi"), " ");
  });
  out = out.replace(/\s+/g," ").trim();
  return out;
}

function toLibrasStyleLine(s, opts){
  const { strictOrder=true } = opts;
  let x = s.replace(/[\"\‚Äú\‚Äù\'\(\)]+/g," ");
  const endPunct = /[\.!\?]$/.test(x) ? x.slice(-1) : "";
  x = x.replace(/[\,\;\:]+/g," ");
  let tokens = x.split(/\s+/).filter(Boolean).map(t=>{
    const low = t.toLowerCase();
    if (WHITELIST.has(low)) return t;
    if (ARTICLES.includes(low)) return "";
    return t;
  }).filter(Boolean);
  tokens = tokens.map(t=>{
    const low = t.toLowerCase();
    if (WHITELIST.has(low)) return t;
    if (/[A-Z]{2,}/.test(t)) return t;
    return reduceVerbSafely(t);
  });
  const tempo = [];
  const resto = [];
  tokens.forEach(t=>{
    if (TEMP_MARKERS.includes(t.toLowerCase())) tempo.push(t.toUpperCase());
    else resto.push(t);
  });
  const ordered = (strictOrder && tempo.length) ? [...tempo, ...resto] : tokens;
  let upper = ordered.join(" ").replace(/\s+/g," ").trim().toUpperCase();
  return upper;
}

function process(){
  const input = document.getElementById('input').value.trim();
  const outSimple = document.getElementById('outSimple');
  const outLibras = document.getElementById('outLibras');
  const mode = document.querySelector('input[name="mode"]:checked').value;
  const strictOrder = document.getElementById('strictOrder').checked;

  if(!input){ outSimple.textContent=""; outLibras.textContent=""; return; }

  const sentences = splitSentences(input);
  const simpleLines = sentences.map(simplifySentence);
  const librasLines = sentences.map(s=> toLibrasStyleLine(s, {strictOrder}));
  outSimple.textContent = "‚Ä¢ " + simpleLines.join("\n‚Ä¢ ");
  outLibras.textContent = "‚Ä¢ " + librasLines.join("\n‚Ä¢ ");
}

/* ===== UI ===== */
function fillSample(){
  document.getElementById('input').value =
"1 - üëçüèº\n\n2 - A segunda frase do card 6 eu n√£o gostei muito. N√£o acho que a a√ß√£o passiva de observar a chama esteja em harmonia com a primeira frase que denota a a√ß√£o de educar. Acho que ficaria melhor algo como: Educar √© acender chamas e prover o necess√°rio para que estas iluminem fam√≠lias e comunidades inteiras.\n\n3 - Erro de digita√ß√£o: ‚Ä¶ que am√©m o que √©‚Ä¶ e eu sugiro que coloque n√£o s√≥ verdadeiro, belo e bom. Fiquei em d√∫vida se a palavra discipulado n√£o seria muito evang√©lica, mas √© isso mesmo. N√£o tem outra que fique melhor‚Ä¶";
  process();
}

function clearAll(){
  document.getElementById('input').value = "";
  document.getElementById('outSimple').textContent = "";
  document.getElementById('outLibras').textContent = "";
}

function copyOut(selector, btn){
  const el = document.querySelector(selector);
  const text = el.textContent;

  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(text).then(()=> flash(btn,"Copiado")).catch(()=> legacyCopy(text,btn));
  } else {
    legacyCopy(text, btn);
  }
}
function legacyCopy(text, btn){
  const ta = document.createElement('textarea');
  ta.value = text;
  ta.style.position = 'fixed';
  ta.style.opacity = '0';
  document.body.appendChild(ta);
  ta.focus();
  ta.select();
  try{ document.execCommand('copy'); flash(btn,"Copiado"); }
  catch(e){ flash(btn,"Selecione e copie"); }
  document.body.removeChild(ta);
}
function flash(btn, msg){
  const old = btn.textContent;
  btn.textContent = msg;
  setTimeout(()=> btn.textContent = old, 1200);
}
</script>
</body>
</html>
