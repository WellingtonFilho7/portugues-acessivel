<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Português Acessível para Surdos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,sans-serif;max-width:980px;margin:24px auto;padding:0 16px;line-height:1.5;background:#f8f9fa;color:#212529}
    h1{font-size:1.75rem;margin:0 0 8px;color:#0056b3;}
    .grid{display:grid;gap:20px}
    @media(min-width:940px){.grid{grid-template-columns:1fr 1fr}}
    .card{border:1px solid #dee2e6;border-radius:12px;padding:20px;background:#fff;box-shadow:0 4px 6px rgba(0,0,0,0.05)}
    textarea{width:100%;min-height:200px;padding:12px;border:1px solid #ced4da;border-radius:8px;resize:vertical;font-size:1rem;}
    textarea:focus{border-color:#80bdff;outline:0;box-shadow:0 0 0 0.2rem rgba(0,123,255,.25)}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0 4px}
    button{padding:10px 16px;border:1px solid #ced4da;border-radius:8px;background:#fff;cursor:pointer;font-weight:500;transition:all .2s}
    button:hover{background:#e9ecef;border-color:#adb5bd}
    .primary{background:#007bff;color:white;border-color:#007bff}
    .primary:hover{background:#0056b3;border-color:#0056b3}
    .small{font-size:.9rem;color:#6c757d}
    .out{white-space:pre-wrap;background:#f8f9fa;padding:12px;border:1px solid #dee2e6;border-radius:8px;min-height:60px;font-size:1rem;}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .row{display:flex;flex-wrap:wrap;gap:16px;align-items:center}
    label{display:inline-flex;gap:8px;align-items:center;cursor:pointer}
    #whitelistContainer { display: none; margin-top: 16px; border-top: 1px solid #eee; padding-top: 16px; }
    #toggleWhitelist { cursor: pointer; color: #007bff; text-decoration:none; font-size: .9rem; }
    #toggleWhitelist:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h1>Português Acessível</h1>
  <p class="small">Adapte textos para uma leitura mais clara. Ideal para laudos, documentos e comunicação direta.</p>

  <div class="grid">
    <div class="card">
      <h3>Seu Texto</h3>
      <textarea id="input" placeholder="Cole o texto original aqui..."></textarea>

      <div class="row" style="margin:16px 0">
        <label><input type="radio" name="mode" value="simple" checked> Simplificado Leve</label>
        <label><input type="radio" name="mode" value="libras"> Estilo Libras</label>
      </div>

      <div class="toolbar">
        <button onclick="fillSample()">Exemplo</button>
        <button onclick="clearAll()">Limpar</button>
        <button class="primary" onclick="process()">Gerar Adaptação</button>
      </div>
      
      <div style="margin-top: 20px;">
        <a id="toggleWhitelist" onclick="toggleWhitelist()">Editar lista de exceções</a>
        <div id="whitelistContainer">
          <p class="small" style="margin-top:8px;">Palavras que não devem ser alteradas (uma por linha). A lista é salva no seu navegador.</p>
          <textarea id="whitelistBox" onkeyup="saveWhitelist()" style="min-height: 120px;"></textarea>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>Texto Adaptado</h3>
      <div id="results" style="display: none;">
        <h4 style="margin-top:0;">Versão Simplificada</h4>
        <div class="out" id="outSimple"></div>
        <div class="toolbar" style="margin-top:10px; margin-bottom: 20px;">
          <button onclick="copyOut('#outSimple', this)">Copiar Simplificado</button>
        </div>

        <h4>Versão Estilo Libras</h4>
        <div class="out mono" id="outLibras"></div>
        <div class="toolbar" style="margin-top:10px;">
          <button onclick="copyOut('#outLibras', this)">Copiar Estilo Libras</button>
        </div>
      </div>
      <p id="resultsPlaceholder" class="small">Os resultados da adaptação aparecerão aqui.</p>
    </div>
  </div>

<script>
  // Script idêntico ao anterior, apenas com as novas funções de UI
  let WHITELIST = new Set();

  function saveWhitelist() {
    const whitelistText = document.getElementById('whitelistBox').value;
    WHITELIST = new Set(whitelistText.split(/\r?\n/).map(s => s.trim().toLowerCase()).filter(Boolean));
    localStorage.setItem('userWhitelist', whitelistText);
  }

  function restoreWhitelistFromStorage() {
    const savedList = localStorage.getItem('userWhitelist');
    const whitelistBox = document.getElementById('whitelistBox');
    if (savedList) {
      whitelistBox.value = savedList;
    } else {
      whitelistBox.value = "discipulado\nfamília\nfamílias\ncomunidade\ncomunidades\nverdade\nbelo\nbom\nSalmo\nSalmos\nLibras\nPortuguês\nBíblia";
    }
    saveWhitelist();
  }

  function toggleWhitelist() {
    const container = document.getElementById('whitelistContainer');
    const link = document.getElementById('toggleWhitelist');
    if (container.style.display === 'none' || container.style.display === '') {
      container.style.display = 'block';
      link.textContent = 'Ocultar lista de exceções';
    } else {
      container.style.display = 'none';
      link.textContent = 'Editar lista de exceções';
    }
  }

  const SIMPLE_REPLACE = new Map(Object.entries({
    "todavia":"mas", "entretanto":"mas", "porém":"mas", "contudo":"mas", "consequentemente":"por isso", "portanto":"por isso",
    "posteriormente":"depois", "anteriormente":"antes", "frequentemente": "muitas vezes", "prover": "dar", "fornecer": "dar",
    "obter": "conseguir", "alcançar": "conseguir", "realizar": "fazer", "efetuar": "fazer", "utilizar": "usar",
    "essencial": "importante", "fundamental": "importante", "harmonia": "paz", "denota": "mostra", "necessário": "precisa",
    "demonstrar": "mostrar", "objetivo": "meta",
  }));

  const ARTICLES = ["o","a","os","as","um","uma","uns","umas","do","da","dos","das","ao","à","aos","às"];
  const FILLERS = ["realmente","basicamente","literalmente","provavelmente","talvez","certamente","claramente","apenas","somente","inclusive"];
  const TEMP_MARKERS = ["hoje","amanhã","ontem","agora","depois","antes","cedo","tarde","noite", "segunda","terça","quarta","quinta","sexta","sábado","domingo", "janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"];

  function reduceVerbSafely(word) {
    const w = word.toLowerCase();
    if (WHITELIST.has(w) || w.length < 4 || /[^a-záéíóúâêôãõç]/i.test(w)) return word;
    const rules = [
      [/(.+)ei\b/i, "$1ar"], [/(.+)ou\b/i, "$1ar"], [/(.+)am\b/i, "$1ar"], [/(.+)amos\b/i, "$1ar"],
      [/(.+)aram\b/i, "$1ar"], [/(.+)arão\b/i, "$1ar"], [/(.+)aria\b/i, "$1ar"], [/(.+)asse\b/i, "$1ar"],
      [/(.+)ava\b/i, "$1ar"], [/(.+)ando\b/i, "$1ar"], [/(.+)ado\b/i, "$1ar"],
      [/(.+)(emos|eram|erão|eria|esse|endo|ido)\b/i, "$1er"],
      [/(.+)(imos|iram|irão|iria|isse|indo)\b/i, "$1ir"],
    ];
    for (const [re, rep] of rules) { if (re.test(word)) return word.replace(re, rep); }
    return word;
  }

  function splitSentences(t) { return t.replace(/\s+/g," ").split(/(?<=[\.\!\?\;])\s+|,\s+(?=[A-ZÁÉÍÓÚÃÕÂÊÔ0-9])/g).map(s=>s.trim()).filter(Boolean); }

  function simplifySentence(s) {
    let out = " " + s.toLowerCase() + " ";
    SIMPLE_REPLACE.forEach((to,from)=>{ out = out.replace(new RegExp("\\b"+from+"\\b","gi"), to); });
    FILLERS.forEach(w=>{ out = out.replace(new RegExp("\\b"+w+"\\b","gi"), " "); });
    out = out.replace(/\s+/g," ").trim();
    return out.charAt(0).toUpperCase() + out.slice(1);
  }

  function toLibrasStyleLine(s, opts) {
    const { strictOrder=true } = opts;
    let x = s.replace(/[\"\“\”\'\(\)]+/g," ");
    x = x.replace(/[\,\;\:]+/g," ");
    let tokens = x.split(/\s+/).filter(Boolean).map(t=>{
      const low = t.toLowerCase();
      if (WHITELIST.has(low) || ARTICLES.includes(low)) return "";
      return t;
    }).filter(Boolean);
    tokens = tokens.map(t=>{
      if (WHITELIST.has(t.toLowerCase()) || /[A-Z]{2,}/.test(t)) return t;
      return reduceVerbSafely(t);
    });
    const tempo = [];
    const resto = [];
    tokens.forEach(t=>{ (TEMP_MARKERS.includes(t.toLowerCase()) ? tempo : resto).push(t); });
    const ordered = (strictOrder && tempo.length) ? [...tempo.map(t => t.toUpperCase()), ...resto] : tokens;
    return ordered.join(" ").replace(/\s+/g," ").trim().toUpperCase();
  }

  function process() {
    const input = document.getElementById('input').value.trim();
    const outSimple = document.getElementById('outSimple');
    const outLibras = document.getElementById('outLibras');
    const resultsDiv = document.getElementById('results');
    const placeholder = document.getElementById('resultsPlaceholder');

    if(!input){
      resultsDiv.style.display = 'none';
      placeholder.style.display = 'block';
      return;
    }
    
    resultsDiv.style.display = 'block';
    placeholder.style.display = 'none';

    const sentences = splitSentences(input);
    const simpleLines = sentences.map(simplifySentence);
    const librasLines = sentences.map(s=> toLibrasStyleLine(s, { strictOrder: document.getElementById('strictOrder').checked }));
    outSimple.innerHTML = simpleLines.map(line => `• ${line}`).join("  
");
    outLibras.innerHTML = librasLines.map(line => `• ${line}`).join("  
");
  }

  function fillSample() {
    document.getElementById('input').value = "A análise do seu exame mostra que os discos da coluna estão desidratados e com degeneração, tanto na região cervical quanto na lombar. Em alguns pontos, esses discos estão protruindo e ocupando o espaço foraminal. Posteriormente, faremos uma avaliação postural.";
    process();
  }

  function clearAll() {
    document.getElementById('input').value = "";
    const resultsDiv = document.getElementById('results');
    const placeholder = document.getElementById('resultsPlaceholder');
    resultsDiv.style.display = 'none';
    placeholder.style.display = 'block';
  }

  function copyOut(selector, btn) {
    const el = document.querySelector(selector);
    const text = el.innerText;
    if (!text) return;
    navigator.clipboard.writeText(text).then(()=> flash(btn,"Copiado!")).catch(()=> legacyCopy(text,btn));
  }

  function legacyCopy(text, btn) {
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed'; ta.style.opacity = '0';
    document.body.appendChild(ta);
    ta.focus(); ta.select();
    try{ document.execCommand('copy'); flash(btn,"Copiado!"); }
    catch(e){ flash(btn,"Erro ao copiar"); }
    document.body.removeChild(ta);
  }

  function flash(btn, msg) {
    const old = btn.textContent;
    btn.textContent = msg;
    setTimeout(()=> btn.textContent = old, 1200);
  }

  restoreWhitelistFromStorage();
</script>
</body>
</html>
